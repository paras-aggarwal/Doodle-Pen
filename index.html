<html lang="en">
  <head>
    <link rel="stylesheet" href="pen.css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="assets/doodlepen-favicon.png">
    <meta name="theme-color" content="#418a23">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <title>Doodle Pen : An Online Realtime IDE</title>
  </head>
  <body>

    <!-- Navbar Section -->
    <div class="row no-gutters">
    <div class="col-md-12">
      <nav class="navbar navbar-expand-lg navbar-light" id="nav">
        <a class="navbar-brand" href="#"><img src="assets/logo-doodlepen.png" class="img-responsive" width="200" alt="Doodle Pen" title="Doodle Pen: An Online Realtime IDE"></a><span id="master">A Pen by Paras Aggarwal and Aarti Verma</span>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
            <ul class="navbar-nav">
              <li class="nav-item active">
                <a class="nav-link" href="#"><button class="btn" id="code-btn"><i class="fas fa-cloud"></i> &nbsp;Save</button></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"><button class="btn" id="code-btn"><i class="fas fa-cog"></i> &nbsp;Settings</button></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"><button class="btn" id="code-btn"><i class="fas fa-eye"></i> &nbsp;Change View</button></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"><button class="btn" id="code-btn"><i class="fas fa-sign-in-alt"></i> &nbsp;Log in</button></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"><button class="btn" id="code-btn"><i class="fas fa-user-plus"></i> &nbsp;Sign up</button></a>
              </li>
            </ul>
        </div>
      </nav>
    </div>
    </div>

    <!-- Editor Section -->
    <div class="row no-gutters">
      <div class="col-md-4" id="editor-area">
        <!-- html editor -->
        <div id="html-box">
          <div class="heading">HTML</div>
          <div class="editor" id="html-editor"></div>
        </div>
        
        <!-- css editor -->
        <div id="css-box">
          <div class="heading">CSS</div>
          <div class="editor" id="css-editor"></div>
        </div>  

        <!-- js editor -->
        <div id="js-box">
          <div class="heading">JS</div>
          <div class="editor" id="js-editor"></div>
        </div>
      </div>

      <!-- Preview Section -->
      <div class="col-md-8" id="output">
        <div class="row no-gutters">
          <div class="heading">Result</div>
          <iframe class="preview" id="preview"></iframe>
        </div>
      </div>
    </div>

    <!-- Footer Section -->
    <div class="row no-gutters" id="console-bar">
      <a class="nav-link" href="#"><button class="btn btn-outline-secondary" data-toggle="modal" data-target="#consoleModal"><i class="fas fa-terminal"></i> &nbsp;Console</button></a>
      <a class="nav-link" href="#"><button class="btn btn-outline-secondary"><i class="fas fa-puzzle-piece"></i> &nbsp;Assets</button></a>
    </div>

    <!-- Console Modal -->
    <div class="modal fade" id="consoleModal" tabindex="-1" role="dialog" aria-labelledby="consoleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h6 class="modal-title" id="exampleModalLabel">Console Window</h6>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div id="console-log">
              <p id="console-window"></p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ace Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.1/ace.js"></script>
    <script src="https://cloud9ide.github.io/emmet-core/emmet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.1/ext-emmet.js"></script>    
    <script>
      // HTML
      var htmlEditor = ace.edit("html-editor");
      htmlEditor.setTheme("ace/theme/crimson_editor");
      htmlEditor.session.setMode("ace/mode/html");
      htmlEditor.setOption("enableEmmet", true);
      htmlEditor.session.setTabSize(2);
      htmlEditor.session.setUseWrapMode(true);

      // CSS
      var cssEditor = ace.edit("css-editor");
      cssEditor.setTheme("ace/theme/crimson_editor");
      cssEditor.session.setMode("ace/mode/css");
      cssEditor.session.setTabSize(2);
      cssEditor.session.setUseWrapMode(true);

      // JS
      var jsEditor = ace.edit("js-editor");
      jsEditor.setTheme("ace/theme/crimson_editor");
      jsEditor.session.setMode("ace/mode/javascript");
      jsEditor.session.setTabSize(2);
      jsEditor.session.setUseWrapMode(true);

      // Rendering
      $(document).ready(function() {
        
        $('.editor').on('keyup', function() {
          var html = htmlEditor.getValue();
          var css = cssEditor.getValue();
          var js = jsEditor.getValue();
          var iframeContent = '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge">' + '<style>' + css + '</style>' + '</head><body>' + html + '\n<script>' + js + '<\/script>' + '</body></html>';
          var target = $('#preview')[0].contentWindow.document;
          target.open();
          target.write(iframeContent);
          target.close();
          console.log($('#preview').contents());
        });

        // Console
        var iframeWindow = document.getElementById("preview").contentWindow;
        iframeWindow.console.log = function(val) {
          var divId = document.getElementById("console-window");
          var span = document.createElement("span");
          span.appendChild(document.createTextNode('\n > '+ val));
          divId.appendChild(span);
        };
      });
    </script>
  </body>
</html>